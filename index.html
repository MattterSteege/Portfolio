<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Draggable Trading Cards</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
    }

    #envelope {
      position: fixed;
      width: 500px;
      aspect-ratio: 5 / 3;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      /*perspective: 1000px;*/
    }

    #envelope #card {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    #envelope #envelope-flap {
      position: absolute;
      transform-origin: top;
      width: 100%;
      height: 100%;
    }

    #envelope img {
      position: absolute;
      width: 100%;
      height: 100%;
    }
    </style>
</head>
<body>
<div id="cards-container">

</div>
<div id="envelope">
    <div id="card">
      <img src="/images/Postcard_envelope_bottom.svg" alt="Trading Card">
      <img src="/images/Postcard_envelope_background.svg" alt="Trading Card" style="z-index: -2;">
    </div>
    <div id="envelope-flap">
        <img src="/images/Postcard_envelope_top_out.svg" alt="Envelope Flap outside" style="z-index: 1;">
        <img src="/images/Postcard_envelope_top_in.svg" alt="Envelope Flap inside" style="transform: rotate(180deg); z-index: 0;">
    </div>
</div>

<script>
  //if the css of #envelope-flap is changed (transform: rotateX)


  const envelopeFlap = document.getElementById('envelope-flap');
  const envelopeFlapOutside = document.querySelector('#envelope-flap img:nth-child(1)');
  const envelopeFlapInside = document.querySelector('#envelope-flap img:nth-child(2)');
  let isFlipped = false;

  function flipEnvelope(flipTime = 1000) {
    //rotate envelopeFlap to 90deg, then set the envelopeFlapInside to z-index: 2, then rotate envelopeFlap to 180deg (using ease function and flipEnvelope function)
    if (!isFlipped) {
      ease(0, 90, flipTime / 2, (value) => {
        envelopeFlap.style.transform = `rotateX(${value}deg)`;
      }, 'easeIn');
      setTimeout(() => {
        envelopeFlapInside.style.zIndex = 2;
        ease(90, 180, flipTime / 2, (value) => {
          envelopeFlap.style.transform = `rotateX(${value}deg)`;
        }, 'easeOut');
      }, flipTime / 2);
      isFlipped = true;
    } else {
      ease(180, 90, flipTime / 2, (value) => {
        envelopeFlap.style.transform = `rotateX(${value}deg)`;
      }, 'easeIn');
      setTimeout(() => {
        envelopeFlapInside.style.zIndex = 0;
        ease(90, 0, flipTime / 2, (value) => {
          envelopeFlap.style.transform = `rotateX(${value}deg)`;
        }, 'easeOut');
      }, flipTime / 2);
      isFlipped = false;
    }
  }

  function ease(start, end, time, callback, easeType = 'ease') {
    start = Number(start);
    end = Number(end);
    const startTime = performance.now();
    const duration = time;

    function easeIn(t) {
      return t * t;
    }

    function easeOut(t) {
      return t * (2 - t);
    }

    function easeInOut(t) {
      return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
    }

    function update(currentTime) {
      const elapsed = currentTime - startTime;

      if (elapsed >= duration) {
        callback(end);
        return;
      }
      const progress = elapsed / duration;
      let easedProgress;

      switch (easeType) {
        case 'easeIn':
          easedProgress = easeIn(progress);
          break;
        case 'easeOut':
          easedProgress = easeOut(progress);
          break;
        case 'ease':
        default:
          easedProgress = easeInOut(progress);
          break;
      }
      const easedValue = start + (end - start) * easedProgress;
      callback(easedValue);

      requestAnimationFrame(update);
    }
    requestAnimationFrame(update);
  }
</script>
</body>
</html>